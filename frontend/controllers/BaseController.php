<?php
/**
 * Created by PhpStorm.
 * User: Administrator
 * Date: 2018/12/26 0026
 * Time: 16:52
 */

namespace frontend\controllers;


use common\helpers\CommonHelpers;
use frontend\assets\AppAsset;
use yii\db\ActiveRecord;
use yii\web\Controller;
use yii\web\Response;

class BaseController extends Controller
{
    public $enableCsrfValidation = false;
    public $_userInfo = [];

    function init()
    {
        \Yii::$app->response->format = Response::FORMAT_JSON;
        if (!\Yii::$app->user->isGuest){
            $this->_userInfo = [
                'uid'=>\Yii::$app->user->identity->getId(),
                'username'=>\Yii::$app->user->identity->username,
                'status'=>\Yii::$app->user->identity->status,
            ];
        }
        parent::init(); // TODO: Change the autogenerated stub
    }

   function behaviors()
   {
       return parent::behaviors(); // TODO: Change the autogenerated stub
   }

    function _setValForObj($object,array $array,$save = false){
        try{
            foreach ($array as $k=>$v){
                if ($k=='certificate'){
                    $object->$k = CommonHelpers::base64ToImg($v);
                }else{
                    $object->$k = $v;
                }
            }
            if ($save){
                return $this->_save($object);
            }
            return $object;
        }catch (\Exception $e){
            echo $e->getMessage();
            exit();
        }
    }

    function _save(object $object){
        if ($object instanceof ActiveRecord){
            return $object->save();
        }
        return false;
    }

    function _getUid(){
        if (!\Yii::$app->user->isGuest){
            return \Yii::$app->user->getId();
        }
        return null;
    }

    function actionLogout()
    {
        \Yii::$app->user->logout(true);
    }
}